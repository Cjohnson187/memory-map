rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    // RULE FOR PUBLIC MEMORY DATA (Memory Listener)
    // Allow anyone to read the data, but only authorized users can write.
    // The write rule will be controlled by the Cloud Function
    match /artifacts/{appId}/public/data/memories/{memoryId} {
      allow read: if true;
      allow write: if false;
    }

    // RULE FOR AUTHORIZED USERS (Function Check)
    // This must allow the Cloud Function (which acts as admin) to read/write.
    // The emulator treats Admin SDK calls as authenticated/trusted.
    match /authorizedUsers/{userId} {
      allow read, write: if true;
    }

    // Optional: General fallback rule (often useful for debugging)
    match /{document=**} {
        allow read, write: if false;
    }
  }
}